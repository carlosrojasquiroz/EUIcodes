clc,close,clear;
%---------------------------------------------------------------------------------------------------------------------------
%% Aiyagari model
%---------------------------------------------------------------------------------------------------------------------------
% This code solves the Aiyagari model by the endogenous grid method (EGM).
%---------------------------------------------------------------------------------------------------------------------------
%% 1. Parameters
%---------------------------------------------------------------------------------------------------------------------------
p=parameters();
%---------------------------------------------------------------------------------------------------------------------------
%% 2. Matrices (grid specifications, stationary distribution for z, etc.)
%---------------------------------------------------------------------------------------------------------------------------
m=matrices(p);
%---------------------------------------------------------------------------------------------------------------------------
%% 3. Demand of capital and labor (from firms)
%---------------------------------------------------------------------------------------------------------------------------
[p.K,p.L]=firms(p,m);
%---------------------------------------------------------------------------------------------------------------------------
%% 4. Partial equilibrium
%---------------------------------------------------------------------------------------------------------------------------
% 4.1. Policy and value functions
%---------------------------------------------------------------------------------------------------------------------------
[pe.V,pe.g_a,pe.g_c]=egm(p,m);
%---------------------------------------------------------------------------------------------------------------------------
% 4.2 Euler errors
%---------------------------------------------------------------------------------------------------------------------------
pe.EE=eulererrors(pe.g_a,p,m);
%---------------------------------------------------------------------------------------------------------------------------
% 4.3 Transition matrix
%---------------------------------------------------------------------------------------------------------------------------
pe.tm=transitionmatrix(p,m,pe.g_a,p.intp);
%---------------------------------------------------------------------------------------------------------------------------
% 4.4 Assets distribution
%---------------------------------------------------------------------------------------------------------------------------
pe.dist=stationarydist(p,pe.tm,p.intp);
%---------------------------------------------------------------------------------------------------------------------------
%% 5. General equilibrium
%---------------------------------------------------------------------------------------------------------------------------
ge=solveAiyagari(p,m);
%---------------------------------------------------------------------------------------------------------------------------
% 5.1 Market for capital
%---------------------------------------------------------------------------------------------------------------------------
[ge.Kd_curve,ge.Ks_curve,ge.r_market]=capitalmarket(p,m,ge.r,p.naa/2);
%---------------------------------------------------------------------------------------------------------------------------
%% 6. Graphs
%---------------------------------------------------------------------------------------------------------------------------
graphs(p,m,pe,ge)
%---------------------------------------------------------------------------------------------------------------------------
                              % (c) Carlos Rojas Quiroz  - This version: 05.01.2023